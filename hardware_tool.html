<!DOCTYPE html>
<html lang="en-GB">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PG4ZJ7W444"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-PG4ZJ7W444');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta property="og:title" content="The Component Atlas | EmpoweringEngineers.uk">
    <meta property="og:description" content="Interactive engineering hardware reference database. Specifications, failure modes, and linked standards for Mechanical, Electrical, and Civil components.">
    <meta property="og:image" content="https://www.empoweringengineers.uk/EE_Logo_rect_Solid.png">
    <meta property="og:url" content="https://www.empoweringengineers.uk/hardware_tool.html">
    <meta property="og:type" content="website">

    <title>The Component Atlas | EmpoweringEngineers.uk</title>
    <link rel="icon" type="image/jpeg" href="Favicon.jpg">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7071036534151105" crossorigin="anonymous"></script>
   
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@700&family=Roboto:wght@400;500;700&family=Courier+Prime&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="layout.css">

    <style>
        /* --- ATLAS SPECIFIC LAYOUT --- */
        
        .atlas-container {
            max-width: 1200px;
            width: 100%;
            margin: 30px auto;
            padding: 0 20px;
            box-sizing: border-box;
            display: grid;
            grid-template-columns: 320px 1fr; /* Sidebar | Content */
            gap: 20px;
            height: 85vh; 
        }

        /* SIDEBAR */
        .atlas-sidebar {
            display: flex;
            flex-direction: column;
            padding: 0;
            overflow-y: hidden;
        }

        /* TOOLBAR */
        .context-bar {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .context-bar label {
            font-family: 'Courier Prime', monospace;
            font-size: 0.8rem;
            color: var(--burnt-orange);
            margin-bottom: 5px;
            font-weight: bold;
        }

        .context-bar select {
            width: 100%;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            color: #fff;
            border-radius: 4px;
            font-family: "Arial", sans-serif;
        }

        /* SCROLLABLE LIST AREA */
        .component-list-area {
            overflow-y: auto;
            flex-grow: 1;
        }

        /* MAIN VIEW */
        .atlas-content {
            overflow-y: auto;
            position: relative;
            background-image: 
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            padding-bottom: 50px;
        }

        /* LIST BUTTONS */
        .discipline-btn {
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: var(--slate-grey);
            padding: 15px;
            text-align: left;
            cursor: pointer;
            font-family: 'Courier Prime', monospace;
            font-size: 0.9rem;
            width: 100%;
            transition: all 0.2s;
        }

        .discipline-btn:hover {
            background: var(--hover-green);
            color: var(--terminal-green);
            padding-left: 20px;
        }

        .discipline-btn.active {
            background: var(--terminal-green);
            color: var(--midnight-navy);
            font-weight: bold;
        }

        /* BLUEPRINT CARD STYLING */
        .blueprint-header {
            border-bottom: 2px solid var(--terminal-green);
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            flex-wrap: wrap;
            gap: 10px;
        }

        .blueprint-tag {
            background: var(--hover-green);
            color: var(--terminal-green);
            padding: 5px 10px;
            font-size: 0.8rem;
            border: 1px solid var(--terminal-green);
            font-family: 'Courier Prime', monospace;
        }

        .spec-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .spec-box {
            background: rgba(0, 0, 0, 0.3); 
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 4px;
        }

        .spec-label {
            color: var(--burnt-orange);
            font-family: 'Courier Prime', monospace;
            font-size: 0.85rem;
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
            border-bottom: 1px dashed var(--slate-grey);
            padding-bottom: 5px;
        }

        .spec-text {
            font-size: 0.95rem;
            color: var(--cloud-white);
            line-height: 1.5;
        }

        /* REFERENCE CARDS */
        .ref-mini-card {
            display: block;
            text-decoration: none;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            transition: 0.2s;
        }
        .ref-mini-card:hover {
            border-color: var(--terminal-green);
            background: rgba(0,255,153,0.05);
            transform: translateX(5px);
        }
        .ref-type-badge {
            font-size: 0.7rem;
            color: var(--slate-grey);
            text-transform: uppercase;
            border: 1px solid var(--slate-grey);
            padding: 1px 5px;
            border-radius: 3px;
            margin-right: 5px;
        }
        .ref-link-title {
            color: var(--cloud-white);
            font-size: 0.9rem;
            font-weight: bold;
        }
        .ref-relevance {
            color: var(--terminal-green);
            font-size: 0.7rem;
            font-family: 'Courier Prime', monospace;
            float: right;
            opacity: 0.8;
            font-weight: bold;
        }

        /* ACRONYM TOOLTIP */
        .acronym-link {
            border-bottom: 1px dotted var(--terminal-green);
            color: var(--terminal-green);
            cursor: help;
        }

        #acronymTooltip {
            position: absolute;
            display: none;
            background: var(--midnight-navy);
            border: 1px solid var(--terminal-green);
            padding: 15px;
            z-index: 2000;
            max-width: 300px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.8);
            font-family: 'Courier Prime', monospace;
            font-size: 0.85rem;
            pointer-events: none;
        }

        .tooltip-header {
            color: var(--burnt-orange);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .def-primary {
            background: rgba(255,255,255,0.1);
            padding: 5px;
            border-left: 3px solid var(--terminal-green);
            margin-bottom: 5px;
        }

        /* MOBILE */
        @media (max-width: 800px) {
            .atlas-container { grid-template-columns: 1fr; height: auto; display: block; }
            .atlas-sidebar { max-height: 300px; margin-bottom: 20px; }
            .spec-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <script defer src="header_nav.js"></script>

    <div class="atlas-container">
        
        <div class="card atlas-sidebar">
            <div class="context-bar">
                <label>DISCIPLINE FILTER</label>
                <select id="discFilter" onchange="renderList()">
                    <option value="All">All Disciplines</option>
                    <option value="Mechanical">Mechanical</option>
                    <option value="Electrical">Electrical</option>
                    <option value="Civil">Civil/Structural</option>
                    <option value="Automotive">Automotive</option>
                    <option value="Aerospace">Aerospace</option>
                    <option value="Naval">Naval</option>
                    <option value="Nuclear">Nuclear</option>
                </select>
            </div>
            
            <div id="componentList" class="component-list-area">
                </div>
        </div>

        <div class="card atlas-content" id="detailView">
            <div style="text-align:center; padding-top:100px; color:var(--slate-grey);">
                <h2>>> COMPONENT_ATLAS_LOADED</h2>
                <p>Select a hardware component from the left to view specs, failure modes, and related standards.</p>
            </div>
        </div>

    </div>

    <div id="acronymTooltip"></div>

    <script src="hardware_db.js"></script>
    <script src="references.js"></script>
    <script src="acronyms.js"></script>

    <script>
        // --- 1. ACRONYM LOGIC ---
        let acronymSet = new Set();
        if (typeof acronymDb !== 'undefined') {
            acronymSet = new Set(acronymDb.map(item => item.a));
        }

        function parseTextForAcronyms(text, context) {
            if (!text) return '';
            return text.split(/(\s+)/).map(word => {
                const cleanWord = word.replace(/[.,;()]/g, '');
                if (acronymSet.has(cleanWord) && cleanWord.length > 1 && cleanWord === cleanWord.toUpperCase()) {
                    return word.replace(cleanWord, `<span class="acronym-link" onmouseenter="showTooltip(event, '${cleanWord}', '${context}')" onmouseleave="hideTooltip()">${cleanWord}</span>`);
                }
                return word;
            }).join('');
        }

        function showTooltip(e, acronym, context) {
            const tooltip = document.getElementById('acronymTooltip');
            const matches = acronymDb.filter(item => item.a === acronym);
            if (matches.length === 0) return;

            matches.sort((a, b) => {
                if (a.c === context) return -1;
                if (b.c === context) return 1;
                return 0;
            });

            let html = `<div class="tooltip-header">>> ${acronym}</div>`;
            matches.slice(0,3).forEach(match => { 
                const isContext = match.c === context;
                const styleClass = isContext ? 'def-primary' : ''; 
                const prefix = isContext ? 'MATCH' : match.c.toUpperCase();
                html += `<div class="${styleClass}" style="margin-bottom:4px; font-size:0.8rem;"><span style="opacity:0.6">[${prefix}]</span> ${match.m}</div>`;
            });

            tooltip.innerHTML = html;
            tooltip.style.display = 'block';
            moveTooltip(e);
        }

        function moveTooltip(e) {
            const tooltip = document.getElementById('acronymTooltip');
            let left = e.pageX + 15;
            let top = e.pageY + 15;
            if (left + 300 > window.innerWidth) left = e.pageX - 315;
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
        }

        function hideTooltip() {
            document.getElementById('acronymTooltip').style.display = 'none';
        }

        document.body.addEventListener('mousemove', (e) => {
            if (document.getElementById('acronymTooltip').style.display === 'block') {
                moveTooltip(e);
            }
        });


        // --- 2. SMART REFERENCE MATCHING (Weighted Scoring) ---
        
        // 1. Discipline Mapping (Hardware -> Reference DB Categories)
        // Helps cross-reference (e.g., Automotive hardware uses Mechanical books)
        const discMap = {
            "Mechanical": ["Mechanical", "General"],
            "Electrical": ["Electrical", "Systems", "General"],
            "Civil": ["Civil", "General"],
            "Automotive": ["Mechanical", "General"], // Auto relies on Mech
            "Aerospace": ["Mechanical", "Systems", "General"], // Aero is Mech + Systems
            "Naval": ["Mechanical", "Process", "General"], // Ships have pumps (Process) and engines (Mech)
            "Nuclear": ["Process", "Mechanical", "Electrical", "General"]
        };

        // 2. Tag Mapping (Hardware Tag -> Reference Topics)
        // Boosts specific topics based on the component type
        const tagMap = {
            "Fluid Systems": ["Fluids", "Piping", "Valves", "Process", "Thermodynamics"],
            "Piping": ["Piping", "Fluids", "Valves"],
            "Transmission": ["Design", "Analysis", "Tribology"],
            "Tribology": ["Tribology", "Design", "Materials"],
            "Fasteners": ["Design", "Analysis", "Standards"],
            "Springs": ["Design", "Analysis"],
            "Structures": ["Structural", "Analysis", "Materials", "Civil"],
            "Geotechnical": ["Geotech", "Civil"],
            "Concrete": ["Concrete", "Civil", "Materials"],
            "Power Electronics": ["Electronics", "Power", "Circuits"],
            "Instrumentation": ["Control", "Electronics", "Process"],
            "Control": ["Control", "Systems", "Automation"],
            "Propulsion": ["Propulsion", "Aerodynamics", "Thermodynamics"],
            "Avionics": ["Systems", "Electronics", "Software"],
            "Materials": ["Materials", "Data"],
            "Corrosion": ["Materials", "Safety"],
            "Safety": ["Safety", "Regulations"],
            "Thermodynamics": ["Thermodynamics", "Fluids", "Energy"]
        };

        function getReferencesFor(item) {
            if (typeof refDb === 'undefined') return "";

            // Prepare Keywords (Name + Tag)
            const ignoreWords = new Set(["the", "and", "for", "with", "type", "unit", "system"]);
            const nameKeywords = item.name.split(/[\s()-]+/)
                                     .filter(w => w.length > 2 && !ignoreWords.has(w.toLowerCase()));
            
            // Get allowed reference disciplines
            const allowedDiscs = discMap[item.discipline] || ["General"];
            
            // Get boosted topics based on tag
            const boostedTopics = tagMap[item.tag] || [];

            // Score References
            const scoredRefs = refDb.map(ref => {
                let score = 0;
                let matchType = "";

                // 1. Discipline Filter (Binary / Heavy Weight)
                if (allowedDiscs.includes(ref.disc)) {
                    score += 20;
                    if (ref.disc === item.discipline) score += 10; // Exact match bonus
                } else {
                    return { ...ref, score: -100 }; // Filter out completely
                }

                // 2. Keyword Search (Precision)
                let keywordHits = 0;
                nameKeywords.forEach(word => {
                    const regex = new RegExp(word, 'i');
                    if (regex.test(ref.title) || regex.test(ref.desc)) {
                        score += 50;
                        keywordHits++;
                    }
                });
                if(keywordHits > 0) matchType = "KEYWORD MATCH";

                // 3. Topic/Tag Alignment (Context)
                // Does the reference topic match the hardware tag map?
                if (boostedTopics.includes(ref.topic)) {
                    score += 40;
                    if(!matchType) matchType = "TOPIC MATCH";
                }
                
                // 4. Manual Tag Match
                // Does the ref title/desc contain the hardware tag? (e.g. "Piping" in title for "Piping" tag)
                if (ref.title.toLowerCase().includes(item.tag.toLowerCase()) || 
                    ref.desc.toLowerCase().includes(item.tag.toLowerCase())) {
                    score += 30;
                    if(!matchType) matchType = "TAG MATCH";
                }

                // 5. General "Penalty" for IT/Software if Hardware is purely Physical
                // Prevents "Python" books showing up for "Concrete"
                const itTopics = ["Python", "Data", "Coding", "Software", "AI / Coding"];
                const physicalDiscs = ["Civil", "Mechanical", "Naval", "Automotive"];
                
                if (physicalDiscs.includes(item.discipline) && 
                    itTopics.includes(ref.topic) && 
                    !["Control", "Avionics", "Systems"].includes(item.tag)) {
                    score -= 50;
                }
                
                // 6. PEI Boost (Professional Institutions are always good)
                if (ref.type === "Institution" && allowedDiscs.includes(ref.disc)) {
                    score += 15;
                }

                return { ...ref, score, matchType };
            });

            // Filter & Sort
            const topRefs = scoredRefs
                .filter(r => r.score > 10) // Threshold to remove noise
                .sort((a, b) => b.score - a.score)
                .slice(0, 5); // Show top 5

            if (topRefs.length === 0) return "<p style='color:var(--slate-grey); font-size:0.9rem;'>No specific references found in library.</p>";

            let html = "";
            topRefs.forEach(ref => {
                const relevanceLabel = ref.matchType ? `<span class="ref-relevance">${ref.matchType}</span>` : "";
                
                html += `
                <a href="${ref.link}" target="_blank" class="ref-mini-card">
                    <div>
                        <span class="ref-type-badge">${ref.type}</span>
                        <span class="ref-link-title">${ref.title}</span>
                        ${relevanceLabel}
                    </div>
                    <div style="font-size:0.8rem; color:var(--slate-grey); margin-top:2px;">${ref.desc}</div>
                </a>`;
            });
            
            return html;
        }


        // --- 3. HARDWARE ATLAS RENDER ---
        
        function renderList() {
            const filter = document.getElementById('discFilter').value;
            const container = document.getElementById('componentList');
            container.innerHTML = '';

            if (typeof hardwareDb === 'undefined') {
                container.innerHTML = '<div style="padding:20px; color:var(--burnt-orange);">Error: Hardware Database not loaded.</div>';
                return;
            }

            const items = hardwareDb.filter(item => filter === 'All' || item.discipline === filter);

            // Sort alphabetical
            items.sort((a, b) => a.name.localeCompare(b.name));

            items.forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'discipline-btn';
                btn.innerHTML = `> ${item.name} <span style="font-size:0.7em; opacity:0.6;">[${item.tag}]</span>`;
                btn.onclick = () => loadDetail(item.id, btn);
                container.appendChild(btn);
            });
        }

        function loadDetail(id, btnElement) {
            document.querySelectorAll('.discipline-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');

            const data = hardwareDb.find(item => item.id === id);
            const view = document.getElementById('detailView');
            const disc = data.discipline;
            
            // Get Smart References
            const refHtml = getReferencesFor(data);

            view.innerHTML = `
                <div class="blueprint-header">
                    <h2 style="margin:0; border:none; color:var(--cloud-white); font-size:1.8rem;">${data.name}</h2>
                    <span class="blueprint-tag">${data.discipline} // ${data.tag}</span>
                </div>

                <div class="spec-grid">
                    <div class="spec-box" style="grid-column: span 2;">
                        <span class="spec-label">01. DESIGN PRINCIPLES</span>
                        <div class="spec-text">${parseTextForAcronyms(data.design, disc)}</div>
                    </div>

                    <div class="spec-box">
                        <span class="spec-label">02. MANUFACTURING PROCESS</span>
                        <div class="spec-text">${parseTextForAcronyms(data.manufacture, disc)}</div>
                    </div>

                    <div class="spec-box">
                        <span class="spec-label">03. PRACTICAL APPLICATION</span>
                        <div class="spec-text">${parseTextForAcronyms(data.app, disc)}</div>
                    </div>
                    
                    <div class="spec-box" style="border-color: var(--burnt-orange);">
                        <span class="spec-label" style="color:var(--burnt-orange);">04. COMMON FAILURE MODES</span>
                        <div class="spec-text">${parseTextForAcronyms(data.failure, disc)}</div>
                    </div>

                    <div class="spec-box" style="grid-column: span 2; border-left: 3px solid var(--terminal-green);">
                        <span class="spec-label" style="color:var(--terminal-green);">05. RECOMMENDED RESOURCES & STANDARDS</span>
                        <div style="margin-top:10px;">${refHtml}</div>
                    </div>
                </div>
            `;
        }

        window.onload = renderList;
    </script>
	<script defer src="footer.js"></script>
</body>
</html>