<!DOCTYPE html>
<html lang="en-GB">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PG4ZJ7W444"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-PG4ZJ7W444');
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7071036534151105" crossorigin="anonymous"></script>
	
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The Engineering Decoder: A searchable database of 15,000+ technical acronyms. Decode terms from Nuclear, Aerospace, Rail, and Civil sectors instantly.">
	<meta property="og:title" content="The Engineering Decoder | Empowering Engineers UK">
	<meta property="og:description" content="The Engineering Decoder: A searchable database of 15,000+ technical acronyms. Decode terms from Nuclear, Aerospace, Rail, and Civil sectors instantly.">
	<meta property="og:image" content="https://www.empoweringengineers.uk/EE_Logo_rect_Solid.png">
	<meta property="og:url" content="https://www.empoweringengineers.uk/glossary_tool.html">
	<meta property="og:type" content="website">
    
    <title>The Engineering Decoder | EmpoweringEngineers.uk</title>
    <link rel="icon" type="image/jpeg" href="Favicon.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@700&family=Roboto:wght@400;500;700&family=Courier+Prime&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="layout.css">
    
    <script src="acronyms.js"></script>
    
    <style>
        /* PAGE SPECIFIC: Search Results & Game */
        .main-interface { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 50px; }
        .right-column { display: flex; flex-direction: column; gap: 20px; }

        /* TABS FOR LEFT PANEL */
        .panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 15px;
        }
        .panel-tab {
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            color: var(--slate-grey);
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            font-family: inherit;
            text-transform: uppercase;
            font-size: 0.8rem;
        }
        .panel-tab:hover { color: #fff; }
        .panel-tab.active {
            color: var(--terminal-green);
            border-bottom-color: var(--terminal-green);
        }

        /* Unified Filter Bar */
        .filter-bar {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-area {
            display: flex;
            flex-direction: column;
        }
        
        .filter-label {
            font-family: inherit; 
            font-size: 0.75rem;
            color: var(--burnt-orange);
            margin-bottom: 4px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .filter-input {
            width: 100%;
            padding: 8px;
            background: rgba(13, 27, 42, 0.6);
            border: 1px solid var(--border-color);
            color: #fff;
            border-radius: 4px;
            font-family: inherit;
            transition: 0.3s;
            font-size: 0.9rem;
        }
        .filter-input:focus {
            border-color: var(--terminal-green);
            outline: none;
            background: rgba(0,0,0,0.5);
        }
        
        #resultsArea, #sessionLogArea {
            margin-top: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        /* Toggle visibility */
        .panel-content { display: none; }
        .panel-content.active { display: block; }

        /* COMPACT Result Item Styling */
        .result-item {
            background: var(--dark-card);
            border-left: 3px solid var(--terminal-green);
            padding: 6px 12px; /* Reduced Padding */
            margin-bottom: 5px; /* Reduced Margin */
            border-radius: 4px;
            border: 1px solid var(--border-color);
            border-left-width: 3px; 
            animation: slideIn 0.2s ease;
            transition: transform 0.2s ease;
        }
        
        .log-item {
            border-left-color: #FFD700;
            background: rgba(255, 215, 0, 0.05);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2px;
        }

        .acr-term { 
            font-family: inherit;
            font-size: 1rem; 
            color: var(--terminal-green); 
            font-weight: bold; 
        }
        
        .acr-cat { 
            font-size: 0.6rem; 
            padding: 1px 5px; 
            border-radius: 3px; 
            background: rgba(255,255,255,0.05); 
            color: #aaa;
            border: 1px solid rgba(255,255,255,0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .acr-def { 
            display: block; 
            color: var(--cloud-white); 
            font-size: 0.9rem;
            line-height: 1.3;
        }

        /* RIGHT COLUMN (GAME & WOTD) */
        .game-area { text-align: center; }

        /* COMPACT Words of the Day */
        .wotd-section {
            text-align: left;
        }
        
        .wotd-header {
            font-family: inherit;
            color: var(--burnt-orange);
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1rem;
            text-transform: uppercase;
        }
        
        .wotd-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-color);
            padding: 6px 12px; 
            margin-bottom: 5px; 
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .wotd-term { 
            font-family: inherit;
            color: var(--terminal-green); 
            font-weight: bold; 
            font-size: 1rem; 
        }
        
        .wotd-meta { text-align: right; max-width: 70%; }
        .wotd-cat-badge { 
            font-size: 0.6rem; 
            color: var(--burnt-orange); 
            text-transform: uppercase; 
            display: block; 
            margin-bottom: 1px;
            font-weight: bold;
        }
        .wotd-desc { color: var(--slate-grey); font-size: 0.8rem; }

        /* --- GAME UI STYLES --- */
        .game-container { position: relative; min-height: 400px; padding-top: 5px; }
        
        .mode-switch {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap; 
        }
        .mode-btn {
            background: transparent;
            border: 1px solid var(--slate-grey);
            color: var(--slate-grey);
            padding: 5px 10px;
            font-size: 0.7rem;
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.2s;
        }
        .mode-btn:hover { border-color: #fff; color: #fff; }
        .mode-btn.active {
            border-color: var(--terminal-green);
            color: var(--terminal-green);
            background: rgba(0,255,153,0.1);
            font-weight: bold;
            box-shadow: 0 0 10px rgba(0,255,153,0.1);
        }

        .game-q-box { 
            background: rgba(0,0,0,0.3); 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            font-size: 2rem; 
            font-weight: bold; 
            font-family: 'Courier Prime', monospace; 
            color: var(--burnt-orange); 
            border: 1px dashed var(--slate-grey); 
        }
        
        .game-context-hint { font-size: 0.8rem; color: var(--slate-grey); display: block; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Vertical Word Stack Styling */
        .word-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            min-height: 30px;
            transition: color 0.3s;
        }
        
        .word-line {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .char-box {
            font-family: 'Courier Prime', monospace;
            font-size: 1.3rem;
            color: inherit; 
            border-bottom: 2px solid rgba(255,255,255,0.3);
            min-width: 18px;
            text-align: center;
            font-weight: bold;
            transition: color 0.3s;
        }

        .char-initial {
            color: var(--terminal-green) !important;
            border-bottom-color: var(--terminal-green) !important;
            text-shadow: 0 0 8px rgba(0, 255, 153, 0.4);
        }

        .health-bar-container {
            width: 80%;
            height: 6px;
            background: #333;
            margin: 0 auto 15px auto;
            border-radius: 3px;
            overflow: hidden;
        }
        .health-bar-fill {
            height: 100%;
            background: var(--terminal-green);
            width: 100%;
            transition: width 0.3s ease, background-color 0.3s;
        }

        .game-input-area {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        /* Virtual Keyboard */
        .keyboard-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 4px;
            max-width: 320px;
            margin: 0 auto;
        }
        .key-btn {
            width: 28px;
            height: 32px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .key-btn:hover { border-color: var(--terminal-green); }
        .key-btn.used { opacity: 0.3; cursor: default; }
        .key-btn.correct { background: var(--terminal-green); color: #000; border-color: var(--terminal-green); }
        .key-btn.wrong { background: var(--burnt-orange); border-color: var(--burnt-orange); }

        .timer-badge { 
            font-size: 1.1rem; 
            font-weight: bold; 
            color: var(--terminal-green); 
            font-family: 'Courier Prime', monospace; 
            border: 1px solid var(--terminal-green); 
            display: inline-block; 
            padding: 4px 12px; 
            border-radius: 4px; 
            background: rgba(0, 255, 153, 0.05); 
            margin-bottom: 10px;
            transition: all 0.5s;
        }

        /* PULSING ANIMATIONS */
        @keyframes pulse-orange {
            0% { color: #fff; border-color: #fff; }
            50% { color: var(--burnt-orange); border-color: var(--burnt-orange); }
            100% { color: #fff; border-color: #fff; }
        }
        @keyframes pulse-red {
            0% { color: #fff; border-color: #fff; transform: scale(1); }
            50% { color: #ff3333; border-color: #ff3333; transform: scale(1.05); }
            100% { color: #fff; border-color: #fff; transform: scale(1); }
        }
        @keyframes pulse-critical {
            0% { color: #ff3333; opacity: 1; transform: scale(1); }
            25% { color: #fff; opacity: 0.8; transform: scale(1.1); }
            50% { color: #ff3333; opacity: 1; transform: scale(1); }
            75% { color: #fff; opacity: 0.8; transform: scale(1.1); }
            100% { color: #ff3333; opacity: 1; transform: scale(1); }
        }

        .urgency-med { animation: pulse-orange 2s infinite; }
        .urgency-high { animation: pulse-red 1s infinite; }
        .urgency-crit { animation: pulse-critical 0.5s infinite; }

        /* CELEBRATION EFFECTS */
        .record-breaker {
            color: #FFD700 !important; /* Gold */
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            transition: color 0.3s ease;
        }

        .celebration-toast {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            border: 2px solid #FFD700;
            color: #FFD700;
            padding: 15px 30px;
            font-family: 'Courier Prime', monospace;
            font-weight: bold;
            font-size: 1.5rem;
            border-radius: 8px;
            z-index: 50;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            animation: popFade 2s forwards;
            pointer-events: none;
        }

        @keyframes popFade {
            0% { opacity: 0; transform: translate(-50%, -40%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            30% { transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -60%); }
            100% { opacity: 0; transform: translate(-50%, -80%); }
        }

        .start-overlay {
            position: absolute; 
            top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(13, 27, 42, 0.98); 
            z-index: 10; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            border-radius: 8px;
        }
        
        .score-box {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            font-family: 'Courier Prime', monospace;
            font-size: 0.9rem;
            color: var(--slate-grey);
        }
        .score-val { color: var(--cloud-white); font-weight: bold; }

        @keyframes slideIn { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }
        
        @media (max-width: 800px) { 
            .main-interface { grid-template-columns: 1fr; } 
            .filter-bar { grid-template-columns: 1fr; } 
        }
    </style>
</head>
<body>
    <script defer src="header_nav.js"></script>

    <div class="container">
        
        <div class="main-interface">
            <div class="card">
                <h2>The Engineering Decoder</h2>
                <div class="panel-tabs">
                    <div class="panel-tab active" id="tabSearch" onclick="switchPanel('search')">Database</div>
                    <div class="panel-tab" id="tabLog" onclick="switchPanel('log')">Session Log</div>
                </div>
                
                <div id="panelSearch" class="panel-content active">
                    <p style="color:var(--slate-grey); margin-bottom:15px; font-size:0.9rem;">
                        Search our database of <span id="dbCount">...</span> engineering acronyms, initialisms, and abbreviations.
                    </p>
                    <div class="filter-bar">
                        <div class="search-area">
                            <label class="filter-label">SEARCH ACRONYM</label>
                            <input type="text" id="searchInput" class="filter-input" placeholder="e.g. HAZOP, PID, BOM..." oninput="triggerSearch()">
                        </div>
                        <div class="search-area">
                            <label class="filter-label">DISCIPLINE</label>
                            <select id="contextFilter" class="filter-input" onchange="triggerSearch()">
                                <option value="All">All Sectors</option>
                                <option value="Project">Project/Contracts</option>
                                <option value="Electrical">Electrical/C&I</option>
                                <option value="Mechanical">Mechanical/Manuf</option>
                                <option value="Civil">Civil/Construction</option>
                                <option value="Safety">HSE/Safety</option>
                                <option value="Nuclear">Nuclear</option>
                                <option value="Pharma">Pharma/Bio</option>
                                <option value="Marine">Marine/Offshore</option>
                                <option value="Aerospace">Aerospace</option>
                                <option value="IT">IT/Computing</option>
                                <option value="Manufacturing">Manufacturing</option>
                            </select>
                        </div>
                    </div>
                    <div id="resultsArea"></div>
                    <div id="emptyState" style="text-align:center; padding:30px; color:var(--slate-grey);">
                        Start typing to search the database...
                    </div>
                </div>

                <div id="panelLog" class="panel-content">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <p style="color:var(--slate-grey); font-size:0.9rem;">Live record of successfully decoded terms.</p>
                        <button onclick="printSessionReport()" style="background:none; border:1px solid var(--terminal-green); color:var(--terminal-green); padding:5px 10px; font-size:0.7rem; border-radius:4px; cursor:pointer;">PRINT REPORT üñ®Ô∏è</button>
                    </div>
                    <div id="sessionLogArea">
                        <div style="text-align:center; color:var(--slate-grey); padding:30px;">
                            No decoded terms yet.<br>Play the game to populate this list!
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-column">
                
                <div class="card game-area">
                    <div class="game-container" id="gameContainer">
                        
                        <div id="startOverlay" class="start-overlay">
                            <h3 style="color:var(--terminal-green); margin-bottom:10px;">ENGINEERING HANGMAN</h3>
                            <p style="color:var(--slate-grey); margin-bottom:20px; font-size:0.9rem;">Decode the acronyms to keep the system online.</p>
                            
                            <div class="score-box">
                                <div>BEST SCORE: <span id="bestScore" class="score-val">0</span></div>
                                <div>MAX STREAK: <span id="bestStreak" class="score-val">0</span></div>
                            </div>

                            <div class="mode-switch">
                                <button class="mode-btn active" id="btnModeHangman" onclick="selectMode('hangman')">Standard</button>
                                <button class="mode-btn" id="btnModeBlitz" onclick="selectMode('blitz')">Blitz (New)</button>
                                <button class="mode-btn" id="btnModeSpeed" onclick="selectMode('speed')">Typing</button>
                            </div>

                            <button class="action-btn" onclick="startGame()" style="width:200px;">INITIALIZE</button>
                            
                            <div style="margin-top:15px;">
                                <button onclick="resetStats()" style="background:none; border:none; color:var(--burnt-orange); font-size:0.75rem; cursor:pointer; text-decoration:underline;">RESET DATA</button>
                            </div>
                        </div>

                        <div style="display:flex; justify-content:space-between; align-items:end; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">
                            <div style="text-align:left;">
                                <div style="font-size:0.65rem; color:var(--burnt-orange); opacity:0.8; margin-bottom:2px;">BEST: <span id="hudBestScore">0</span></div>
                                <div style="font-size:0.7rem; color:var(--slate-grey);">SCORE</div>
                                <div id="scoreVal" style="color:var(--cloud-white); font-weight:bold; font-size:1.4rem; line-height:1.2;">0</div>
                            </div>
                            <div id="timerBadge" class="timer-badge" style="display:none; margin:0; font-size:1rem;">60s</div>
                            <div style="text-align:right;">
                                <div style="font-size:0.65rem; color:var(--burnt-orange); opacity:0.8; margin-bottom:2px;">BEST: <span id="hudBestStreak">0</span></div>
                                <div style="font-size:0.7rem; color:var(--slate-grey);">STREAK</div>
                                <div id="streakVal" style="color:var(--terminal-green); font-weight:bold; font-size:1.4rem; line-height:1.2;">0</div>
                            </div>
                        </div>

                        <span class="game-context-hint" id="qContext">CONTEXT: SYSTEM</span>
                        <div class="game-q-box" id="qAbbr">???</div>

                        <div id="wordDisplay" class="word-display">
                            </div>
                        
                        <div id="healthBarWrapper" style="display:block;">
                            <div style="font-size:0.7rem; color:var(--slate-grey); margin-bottom:5px; text-align:left;">SYSTEM INTEGRITY</div>
                            <div class="health-bar-container">
                                <div id="healthFill" class="health-bar-fill"></div>
                            </div>
                        </div>

                        <div id="keyboardArea" class="keyboard-grid"></div>
                        
                        <div id="speedInputArea" style="display:none;">
                            <input type="text" id="gameInput" class="filter-input" style="text-align:center; font-size:1.1rem;" placeholder="Type definition..." onkeydown="if(event.key === 'Enter') checkSpeedAnswer()">
                            <div style="font-size:0.75rem; color:var(--slate-grey); margin-top:5px;">System decodes automatically. Type to override.</div>
                        </div>

                        <div id="feedbackMsg" style="min-height:30px; margin-top:10px; font-weight:bold;"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="wotd-section">
                        <div class="wotd-header">>> Words of the Day</div>
                        <div id="wotdList">Loading...</div>
                    </div>
                </div>

            </div>
        </div>
		<div class="card" style="margin-top: 40px; border-top: 2px solid var(--burnt-orange);">
            <h3>Why Accurate Terminology Matters in Engineering</h3>
            <p>In safety-critical industries like Nuclear, Aerospace, and Oil & Gas, ambiguity can lead to catastrophic failure. A primary cause of engineering incidents is miscommunication arising from undefined acronyms or discipline-specific jargon.</p>
            
            <h4>The Context Trap</h4>
            <p>A major challenge for multi-disciplinary teams is that the same acronym often holds different meanings across sectors. For example:</p>
            <ul>
                <li><strong>"CV"</strong> means <em>Check Valve</em> to a Mechanical Engineer, but <em>Curriculum Vitae</em> to HR, and <em>Cost Variance</em> to a Project Manager.</li>
                <li><strong>"ATM"</strong> is an <em>Automated Teller Machine</em> to the public, but <em>Asynchronous Transfer Mode</em> to a Systems Engineer.</li>
            </ul>
            
            <h4>Standardization & Safety</h4>
            <p>This database aggregates terms from major standards including <strong>ASME</strong>, <strong>ISO</strong>, and <strong>BS 7671</strong>. When writing technical reports, permit-to-work documents, or operating procedures, always define your acronyms on first use. Use this tool to verify the standard industry definition before issuing documentation.</p>
        </div>
    </div>

    <script>
        // Use 'acronymDb' from external file
        let db = [];
        
        document.addEventListener('DOMContentLoaded', () => {
            if(typeof acronymDb !== 'undefined') {
                db = acronymDb;
                document.getElementById('dbCount').innerText = db.length.toLocaleString();
                generateDailyWords();
                loadStats();
                document.getElementById('searchInput').focus();
            }
        });

        // --- PANEL SWITCH LOGIC ---
        function switchPanel(panel) {
            document.getElementById('panelSearch').classList.remove('active');
            document.getElementById('panelLog').classList.remove('active');
            document.getElementById('tabSearch').classList.remove('active');
            document.getElementById('tabLog').classList.remove('active');

            if(panel === 'search') {
                document.getElementById('panelSearch').classList.add('active');
                document.getElementById('tabSearch').classList.add('active');
            } else {
                document.getElementById('panelLog').classList.add('active');
                document.getElementById('tabLog').classList.add('active');
            }
        }

        // --- PERFORMANCE: DEBOUNCE LOGIC ---
        let searchTimeout;

        function triggerSearch() {
            // Clear the timer if the user keeps typing
            clearTimeout(searchTimeout);
            
            // Set a new timer to run the search in 300ms
            searchTimeout = setTimeout(() => {
                doSearch();
            }, 300);
        }

        // --- SEARCH LOGIC ---
        function doSearch() {
            // Force switch to Search tab if user types
            if(!document.getElementById('panelSearch').classList.contains('active')){
                switchPanel('search');
            }

            const query = document.getElementById('searchInput').value.trim().toUpperCase();
            const category = document.getElementById('contextFilter').value;
            const container = document.getElementById('resultsArea');
            const emptyState = document.getElementById('emptyState');
            
            container.innerHTML = "";
            
            if(query.length < 2) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            emptyState.style.display = 'none';
            
            // Filter
            let matches = db.filter(item => {
                return item.a.toUpperCase().startsWith(query) && (category === "All" || item.c === category);
            });
            
            // Sort (Exact matches first)
            matches.sort((a,b) => (a.a === query ? -1 : 1));
            
            // Render (Limit to 50 for performance)
            if(matches.length === 0) {
                container.innerHTML = `<div class="result-item" style="border-left-color:var(--slate-grey); border-left-width: 1px; opacity: 0.7;"><span class=\"acr-def\">No matches found.</span></div>`;
            } else {
                // Use a document fragment for faster DOM insertion
                const fragment = document.createDocumentFragment();
                
                matches.slice(0, 50).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'result-item';
                    div.innerHTML = `
                        <div class="result-header">
                            <span class="acr-term">${item.a}</span>
                            <span class="acr-cat">${item.c || 'General'}</span>
                        </div>
                        <span class="acr-def">${item.m}</span>
                    `;
                    fragment.appendChild(div);
                });
                
                container.appendChild(fragment);
            }
        }

        // --- SESSION LOGIC ---
        let sessionLog = [];

        function addToSessionLog(item) {
            // Check if already in log
            if(sessionLog.some(log => log.a === item.a)) return;

            sessionLog.unshift(item); // Add to top
            renderSessionLog();
            
            // Auto switch to log view on first success for engagement
            if(sessionLog.length === 1) switchPanel('log'); 
        }

        function renderSessionLog() {
            const container = document.getElementById('sessionLogArea');
            if(sessionLog.length === 0) return;

            container.innerHTML = "";
            sessionLog.forEach(item => {
                container.innerHTML += `
                    <div class="result-item log-item">
                        <div class="result-header">
                            <span class="acr-term">${item.a}</span>
                            <span class="acr-cat">${item.c || 'General'}</span>
                        </div>
                        <span class="acr-def">${item.m}</span>
                    </div>`;
            });
        }

        function printSessionReport() {
            if(sessionLog.length === 0) {
                alert("Play the game to generate a report!");
                return;
            }

            const win = window.open('', '_blank');
            const date = new Date().toLocaleDateString();
            
            let html = `
                <html>
                <head>
                    <title>Session Report - Engineering Decoder</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 40px; color: #333; }
                        h1 { color: #004d40; border-bottom: 2px solid #004d40; padding-bottom: 10px; }
                        .stats { display: flex; gap: 20px; margin-bottom: 30px; font-weight: bold; font-size: 1.2rem; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .footer { margin-top: 40px; font-size: 0.8rem; color: #666; text-align: center; border-top: 1px solid #ddd; padding-top: 20px;}
                    </style>
                </head>
                <body>
                    <h1>Engineering Decoder // Training Session Report</h1>
                    <div class="stats">
                        <span>Date: ${date}</span>
                        <span>Total Decoded: ${sessionLog.length}</span>
                        <span>Final Score: ${document.getElementById('scoreVal').innerText}</span>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Acronym</th>
                                <th>Definition</th>
                                <th>Context</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            sessionLog.forEach(item => {
                html += `
                    <tr>
                        <td><strong>${item.a}</strong></td>
                        <td>${item.m}</td>
                        <td>${item.c || '-'}</td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                    <div class="footer">Generated by EmpoweringEngineers.uk - The Engineering Decoder Tool</div>
                    <script>window.print();<\/script>
                </body>
                </html>
            `;

            win.document.write(html);
            win.document.close();
        }

        // --- STATS LOGIC ---
        function getStorageKeys() {
            if (gameMode === 'speed') return { score: 'decoder_speed_score', streak: 'decoder_speed_streak' };
            if (gameMode === 'blitz') return { score: 'decoder_blitz_score', streak: 'decoder_blitz_streak' };
            return { score: 'decoder_hangman_score', streak: 'decoder_hangman_streak' };
        }

        function loadStats() {
            const keys = getStorageKeys();
            const bestS = parseInt(localStorage.getItem(keys.score) || 0);
            const bestSt = parseInt(localStorage.getItem(keys.streak) || 0);
            
            document.getElementById('bestScore').innerText = bestS;
            document.getElementById('bestStreak').innerText = bestSt;
            document.getElementById('hudBestScore').innerText = bestS;
            document.getElementById('hudBestStreak').innerText = bestSt;
        }

        function checkHighScore(currentScore, currentStreak) {
            const keys = getStorageKeys();
            const bestS = parseInt(localStorage.getItem(keys.score) || 0);
            const bestSt = parseInt(localStorage.getItem(keys.streak) || 0);
            
            let isNewRecord = false;

            if(currentScore > bestS) {
                localStorage.setItem(keys.score, currentScore);
                document.getElementById('hudBestScore').innerText = currentScore;
                document.getElementById('hudBestScore').classList.add('record-breaker');
                document.getElementById('scoreVal').classList.add('record-breaker');
                isNewRecord = true;
            }

            if(currentStreak > bestSt) {
                localStorage.setItem(keys.streak, currentStreak);
                document.getElementById('hudBestStreak').innerText = currentStreak;
            }

            if(isNewRecord && !window.celebrationTriggered) {
                triggerCelebration();
                window.celebrationTriggered = true;
            }
        }

        function triggerCelebration() {
            const gameContainer = document.getElementById('gameContainer');
            const toast = document.createElement('div');
            toast.className = 'celebration-toast';
            toast.innerText = "NEW HIGH SCORE!";
            gameContainer.appendChild(toast);
            setTimeout(() => { toast.remove(); }, 2000);
        }

        function resetStats() {
            const keys = getStorageKeys();
            if(confirm(`Reset high scores for this mode?`)) {
                localStorage.removeItem(keys.score);
                localStorage.removeItem(keys.streak);
                loadStats();
            }
        }

        // --- WOTD LOGIC ---
        function generateDailyWords() {
            if(db.length === 0) return;
            const today = new Date().toISOString().slice(0,10).replace(/-/g,'');
            const seed = parseInt(today); 
            let random = seededRandom(seed);
            let indices = new Set();
            while(indices.size < 3) {
                let idx = Math.floor(random() * db.length);
                if(db[idx].m.length < 50) indices.add(idx);
            }
            const container = document.getElementById('wotdList');
            container.innerHTML = "";
            indices.forEach(i => {
                const item = db[i];
                container.innerHTML += `
                    <div class="wotd-item">
                        <span class="wotd-term">${item.a}</span>
                        <div class="wotd-meta">
                            <span class="wotd-cat-badge">${item.c || 'General'}</span>
                            <span class="wotd-desc">${item.m}</span>
                        </div>
                    </div>`;
            });
        }
        function seededRandom(a) {
            return function() {
              var t = a += 0x6D2B79F5;
              t = Math.imul(t ^ t >>> 15, t | 1);
              t ^= t + Math.imul(t ^ t >>> 7, t | 61);
              return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }

        // --- GAME ENGINE ---
        let gameMode = 'hangman'; 
        let currentQ = null;
        let score = 0;
        let streak = 0;
        let lives = 6;
        let timeLeft = 60; // Default 60s
        let timerInterval = null;
        let speedRevealInterval = null;
        let hiddenWord = []; 
        let gameIsPaused = false; 

        function selectMode(mode) {
            gameMode = mode;
            document.getElementById('btnModeHangman').classList.toggle('active', mode === 'hangman');
            document.getElementById('btnModeBlitz').classList.toggle('active', mode === 'blitz');
            document.getElementById('btnModeSpeed').classList.toggle('active', mode === 'speed');
            loadStats(); 
        }

        function startGame() {
            score = 0;
            streak = 0;
            lives = 6;
            timeLeft = 60; 
            gameIsPaused = false;
            window.celebrationTriggered = false;
            
            // Clear Session Log on new game? No, let it persist for "Session"
            // If they reload page, it clears. If they just restart game, keep log.
            
            document.getElementById('hudBestScore').classList.remove('record-breaker');
            document.getElementById('scoreVal').classList.remove('record-breaker');

            document.getElementById('startOverlay').style.display = 'none';
            document.getElementById('scoreVal').innerText = "0";
            document.getElementById('streakVal').innerText = "0";
            
            if(gameMode === 'hangman' || gameMode === 'blitz') {
                document.getElementById('keyboardArea').style.display = 'flex';
                document.getElementById('speedInputArea').style.display = 'none';
                document.getElementById('healthBarWrapper').style.display = 'block';
                
                if(gameMode === 'blitz') {
                    document.getElementById('timerBadge').style.display = 'block'; 
                    startTimer();
                } else {
                    document.getElementById('timerBadge').style.display = 'none';
                }

            } else {
                // Speed (Typing) Mode
                document.getElementById('timerBadge').style.display = 'block';
                document.getElementById('keyboardArea').style.display = 'none';
                document.getElementById('speedInputArea').style.display = 'block';
                document.getElementById('healthBarWrapper').style.display = 'none';
                startTimer();
            }

            nextQuestion();
        }

        function nextQuestion() {
            gameIsPaused = false;
            let pool = db.filter(x => x.m.length < 40 && x.m.match(/^[a-zA-Z\s-]+$/)); 
            if(pool.length === 0) pool = db; 
            currentQ = pool[Math.floor(Math.random() * pool.length)];
            
            document.getElementById('qAbbr').innerText = currentQ.a;
            document.getElementById('qContext').innerText = "CONTEXT: " + (currentQ.c || "General").toUpperCase(); 
            document.getElementById('feedbackMsg').innerHTML = "";

            if(gameMode === 'hangman' || gameMode === 'blitz') {
                setupHangmanRound(); 
            } else {
                setupSpeedRound();
            }
        }

        function updateWordDisplay() {
            const container = document.getElementById('wordDisplay');
            container.innerHTML = ''; 
            let currentLine = document.createElement('div');
            currentLine.className = 'word-line';
            let isWordStart = true;
            
            container.className = 'word-display'; 
            if (gameMode !== 'hangman' && !gameIsPaused) {
                if (timeLeft <= 5) container.classList.add('urgency-crit');
                else if (timeLeft <= 15) container.classList.add('urgency-high');
                else if (timeLeft <= 30) container.classList.add('urgency-med');
            }

            hiddenWord.forEach(char => {
                if (char === ' ') {
                    container.appendChild(currentLine);
                    currentLine = document.createElement('div');
                    currentLine.className = 'word-line';
                    isWordStart = true;
                } else {
                    const span = document.createElement('span');
                    span.className = 'char-box';
                    span.innerText = char;
                    if(isWordStart && char !== '_') span.classList.add('char-initial');
                    currentLine.appendChild(span);
                    isWordStart = false;
                }
            });
            container.appendChild(currentLine);
        }

        // --- HANGMAN & BLITZ LOGIC ---
        function setupHangmanRound() {
            const answer = currentQ.m.toUpperCase();
            hiddenWord = answer.split('').map(char => /[A-Z]/.test(char) ? '_' : char);
            
            lives = 6; 
            updateHealthBar();

            const kb = document.getElementById('keyboardArea');
            kb.innerHTML = "";
            "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('').forEach(letter => {
                const btn = document.createElement('button');
                btn.className = 'key-btn';
                btn.id = 'btn-key-' + letter;
                btn.innerText = letter;
                btn.onclick = () => handleGuess(letter, btn);
                kb.appendChild(btn);
            });

            const acronymChars = currentQ.a.toUpperCase().split('');
            [...new Set(acronymChars)].forEach(char => {
                if(/[A-Z]/.test(char)) {
                    const btn = document.getElementById('btn-key-' + char);
                    if(btn) handleGuess(char, btn, true); 
                }
            });

            updateWordDisplay();
        }

        function handleGuess(letter, btn, isFreebie = false) {
            if(btn.disabled || gameIsPaused) return;
            btn.disabled = true;
            btn.classList.add('used');
            
            const answer = currentQ.m.toUpperCase();
            if(answer.includes(letter)) {
                btn.classList.add('correct');
                answer.split('').forEach((char, idx) => { if(char === letter) hiddenWord[idx] = letter; });
                updateWordDisplay();
                
                if(!hiddenWord.includes('_')) {
                    // WIN
                    if(!isFreebie) score += 50 + (lives * 10);
                    if(gameMode === 'blitz') {
                        score += 50; 
                        timeLeft += 15; 
                        document.getElementById('timerBadge').innerText = timeLeft + "s";
                    }
                    streak++;
                    document.getElementById('scoreVal').innerText = score;
                    document.getElementById('streakVal').innerText = streak;
                    checkHighScore(score, streak);
                    
                    // Add to Session Log
                    addToSessionLog(currentQ);

                    document.getElementById('feedbackMsg').innerHTML = `<span style="color:var(--terminal-green)">ACCESS GRANTED!</span>`;
                    
                    gameIsPaused = true; 
                    updateWordDisplay(); 
                    setTimeout(nextQuestion, 3000); 
                }
            } else {
                if(!isFreebie) {
                    btn.classList.add('wrong');
                    lives--;
                    updateHealthBar();
                    if(lives <= 0) gameOver();
                }
            }
        }

        function updateHealthBar() {
            const fill = document.getElementById('healthFill');
            const pct = (lives / 6) * 100;
            fill.style.width = pct + "%";
            fill.style.backgroundColor = (lives <= 2) ? "var(--burnt-orange)" : "var(--terminal-green)";
        }

        // --- SPEED (TYPING) LOGIC ---
        function setupSpeedRound() {
            const answer = currentQ.m.toUpperCase();
            hiddenWord = answer.split('').map(char => /[A-Z]/.test(char) ? '_' : char);
            
            // FIX: Auto-reveal letters found in the Acronym
            const acronymChars = new Set(currentQ.a.toUpperCase().split(''));
            answer.split('').forEach((char, idx) => {
                if (acronymChars.has(char)) {
                    hiddenWord[idx] = char;
                }
            });

            updateWordDisplay();
            
            document.getElementById('gameInput').value = "";
            document.getElementById('gameInput').focus();

            const lettersToGuess = hiddenWord.filter(c => c === '_').length;
            const revealRateMs = lettersToGuess > 0 ? (60000 / lettersToGuess) : 2000; 

            clearInterval(speedRevealInterval);
            speedRevealInterval = setInterval(revealRandomLetter, revealRateMs);
        }

        function revealRandomLetter() {
            if(gameIsPaused) return;
            let hiddenIndices = [];
            hiddenWord.forEach((char, idx) => { if(char === '_') hiddenIndices.push(idx); });

            if(hiddenIndices.length > 0) {
                const rnd = Math.floor(Math.random() * hiddenIndices.length);
                const idx = hiddenIndices[rnd];
                hiddenWord[idx] = currentQ.m.toUpperCase()[idx];
                updateWordDisplay();
            }
        }

        function checkSpeedAnswer() {
            if(gameIsPaused) return;
            const input = document.getElementById('gameInput').value.trim().toLowerCase();
            const correct = currentQ.m.toLowerCase();
            
            if(input.length > 3 && correct.includes(input)) {
                // Win
                clearInterval(speedRevealInterval);
                hiddenWord = currentQ.m.toUpperCase().split('');
                updateWordDisplay();

                score += 100;
                streak++;
                timeLeft += 20; 
                
                document.getElementById('scoreVal').innerText = score;
                document.getElementById('streakVal').innerText = streak;
                document.getElementById('timerBadge').innerText = timeLeft + "s"; 
                checkHighScore(score, streak);
                
                // Add to Session Log
                addToSessionLog(currentQ);

                document.getElementById('gameInput').style.borderColor = "var(--terminal-green)";
                setTimeout(() => document.getElementById('gameInput').style.borderColor = "var(--border-color)", 500);
                
                gameIsPaused = true;
                setTimeout(() => {
                    nextQuestion();
                }, 3000);
            } else {
                document.getElementById('gameInput').value = "";
                document.getElementById('gameInput').placeholder = "Try again...";
            }
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if(!gameIsPaused) {
                    timeLeft--;
                    document.getElementById('timerBadge').innerText = timeLeft + "s";
                    
                    document.getElementById('timerBadge').className = 'timer-badge'; 
                    if(timeLeft <= 5) document.getElementById('timerBadge').classList.add('urgency-crit');
                    else if(timeLeft <= 15) document.getElementById('timerBadge').classList.add('urgency-high');
                    else if(timeLeft <= 30) document.getElementById('timerBadge').classList.add('urgency-med');

                    updateWordDisplay();

                    if(timeLeft <= 0) gameOver();
                }
            }, 1000);
        }

        function gameOver() {
            clearInterval(timerInterval);
            clearInterval(speedRevealInterval);
            checkHighScore(score, streak);

            const overlay = document.getElementById('startOverlay');
            overlay.style.display = 'flex';
            
            const title = overlay.querySelector('h3');
            const desc = overlay.querySelector('p');
            
            title.innerText = "SYSTEM LOCKOUT";
            title.style.color = "var(--burnt-orange)";
            desc.innerHTML = `Game Over. Final Score: <b>${score}</b><br>The answer was: <span style="color:#fff">${currentQ.m}</span>`;
            
            document.querySelector('.action-btn').innerText = "REBOOT SYSTEM";
            loadStats();
        }

    </script>
    
    <script defer src="footer.js"></script>
</body>
</html>