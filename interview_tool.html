<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PG4ZJ7W444"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-PG4ZJ7W444');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Interviewer | Empowering Engineers</title>
    <link rel="icon" type="image/jpeg" href="Favicon.jpg">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7071036534151105" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@700&family=Roboto:wght@400;500;700&family=Courier+Prime&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="layout.css">
    
    <style>
        /* INTERVIEW TOOL SPECIFIC STYLES */
        .interview-container {
            max-width: 900px;
            width: 100%;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .screen-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            position: relative;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .category-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--terminal-green);
            color: var(--midnight-navy);
            padding: 5px 10px;
            font-family: 'Courier Prime', monospace;
            font-weight: bold;
            font-size: 0.8rem;
            border-radius: 4px;
        }

        .question-text {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            line-height: 1.4;
            color: var(--cloud-white);
            margin: 20px 0;
        }

        .timer-display {
            font-family: 'Courier Prime', monospace;
            font-size: 2rem;
            color: var(--slate-grey);
            margin-top: 20px;
        }
        .timer-display.recording { color: var(--alert-red); animation: pulse 1s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: 1px solid var(--terminal-green);
            background: transparent;
            color: var(--terminal-green);
            font-family: 'Courier Prime', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        .btn:hover { background: var(--terminal-green); color: var(--midnight-navy); }
        .btn:disabled { border-color: #555; color: #555; cursor: not-allowed; background: transparent; }
        
        .btn-record { border-color: var(--alert-red); color: var(--alert-red); }
        .btn-record:hover { background: var(--alert-red); color: white; }

        .btn-ai { border-color: var(--burnt-orange); color: var(--burnt-orange); }
        .btn-ai:hover { background: var(--burnt-orange); color: white; }

        /* AI Prompt Modal */
        .ai-modal {
            display: none;
            margin-top: 20px;
            background: rgba(13, 27, 42, 0.9);
            border: 1px solid var(--burnt-orange);
            padding: 20px;
            border-radius: 4px;
            text-align: left;
            width: 100%;
        }
        .ai-text {
            width: 100%;
            height: 150px;
            background: #000;
            color: #0f0;
            font-family: 'Courier Prime', monospace;
            border: 1px solid #333;
            padding: 10px;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        /* Settings Area */
        .settings-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            font-family: 'Roboto', sans-serif;
            font-size: 0.9rem;
            color: var(--slate-grey);
        }
        
        select {
            background: var(--midnight-navy);
            color: var(--cloud-white);
            border: 1px solid var(--border-color);
            padding: 5px;
        }
    </style>
</head>
<body>

    <div class="sticky-container">
        <a href="index.html" class="site-brand">Empowering<span>Engineers</span>.uk</a>
        <nav>
            <a href="cpd_tool.html">CPD</a>
            <a href="raci_tool.html">RACI</a>
            <a href="STAR_engine.html">STAR-Gen</a>
            <a href="STAR_reviewer.html">Reviewer</a>
            <a href="ethics_tool.html">Ethics</a>
            <a href="feedback_tool.html">Coach</a>
            <a href="glossary_tool.html">Decoder</a>
            <a href="report_tool.html">Report</a>
            <a href="interview_tool.html" class="active">Interview</a>
            <a href="guide.html">Manual</a>
        </nav>
    </div>

    <h1 style="margin-top: 20px; text-align: center; color: var(--terminal-green);">Virtual Interview Simulator</h1>
    <p style="text-align: center; max-width: 800px; margin-bottom: 20px;">
        Practice your Professional Review Interview (PRI). Select your mode, hit record, and answer out loud. 
        Use the AI Interrogator to critique your transcript against UK-SPEC.
    </p>

    <div class="settings-bar">
        <div>
            <label>Competency Focus:</label>
            <select id="compSelect">
                <option value="All">All Competencies (Full Mock)</option>
                <option value="A">A - Innovation & Problem Solving</option>
                <option value="B">B - Technical Solution</option>
                <option value="C">C - Management & Responsibility</option>
                <option value="D">D - Communication</option>
                <option value="E">E - Ethics & Safety</option>
            </select>
        </div>
        <div>
            <label>Timer:</label>
            <select id="timeSelect">
                <option value="120">2 Minutes (Standard)</option>
                <option value="300">5 Minutes (Deep Dive)</option>
                <option value="60">1 Minute (Rapid Fire)</option>
            </select>
        </div>
    </div>

    <div class="interview-container">
        
        <div class="screen-card" id="questionCard">
            <div class="category-badge" id="catBadge">READY</div>
            <div class="question-text" id="qText">Press 'Start Interview' to begin.</div>
            <div class="timer-display" id="timer">00:00</div>
            
            <div id="aiSection" class="ai-modal">
                <strong style="color:var(--burnt-orange)">>> AI ASSESSOR PROMPT GENERATED</strong>
                <p style="font-size:0.8rem; margin:5px 0;">1. Transcribe your answer (using Word Dictate, Otter.ai, or typing).<br>2. Copy the prompt below.<br>3. Paste both into ChatGPT/Claude.</p>
                <textarea id="aiPromptBox" class="ai-text" readonly></textarea>
                <button class="btn btn-ai" onclick="copyPrompt()" style="margin-top:10px; width:100%;">COPY PROMPT TO CLIPBOARD</button>
            </div>
        </div>

        <div class="controls">
            <button class="btn" id="startBtn" onclick="startInterview()">Start Interview</button>
            <button class="btn" id="nextBtn" onclick="nextQuestion()" disabled>Next Question >></button>
            <button class="btn btn-record" id="recBtn" onclick="toggleRecording()" disabled>Rec</button>
            <button class="btn btn-ai" id="aiBtn" onclick="generatePrompt()" disabled>AI Review</button>
        </div>

        <audio id="audioPlayback" controls style="width: 100%; display: none;"></audio>

    </div>

    <footer>
        <p>&copy; <script>document.write(new Date().getFullYear())</script> Empowering Engineers UK</p>
        <p>
            <a href="about.html">About Us</a> | 
            <a href="contact.html">Contact Us</a> | 
            <a href="terms.html">Terms of Use</a> | 
            <a href="privacy.html">Privacy Policy</a>
        </p>
    </footer>
    
    <script src="questions.js"></script>

    <script>
        let currentQ = null;
        let timerInterval = null;
        let seconds = 0;
        let isRecording = false;
        let mediaRecorder;
        let audioChunks = [];

        // --- CORE FUNCTIONS ---

        function startInterview() {
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('recBtn').disabled = false;
            document.getElementById('aiBtn').disabled = false;
            nextQuestion();
        }

        function nextQuestion() {
            // Hide AI box from previous question
            document.getElementById('aiSection').style.display = 'none';
            document.getElementById('audioPlayback').style.display = 'none';
            
            // Filter questions based on selection (Updated to include sub-categories like A1, A2)
            const filter = document.getElementById('compSelect').value;
            let available = questions; // 'questions' is now loaded from questions.js
            
            if(filter !== "All") {
                // Allows "A" to match "A1", "A2", etc.
                available = questions.filter(q => q.catCode.startsWith(filter) || q.catCode === "Intro");
            }

            // Pick random
            const randomIndex = Math.floor(Math.random() * available.length);
            currentQ = available[randomIndex];

            // Update UI
            document.getElementById('catBadge').innerText = currentQ.catLabel;
            document.getElementById('qText').innerText = currentQ.text;
            
            resetTimer();
        }

        // --- TIMER & RECORDING ---

        function toggleRecording() {
            const btn = document.getElementById('recBtn');
            const timerDisplay = document.getElementById('timer');

            if (!isRecording) {
                // START RECORDING
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        mediaRecorder = new MediaRecorder(stream);
                        mediaRecorder.start();
                        audioChunks = [];

                        mediaRecorder.ondataavailable = event => {
                            audioChunks.push(event.data);
                        };

                        mediaRecorder.onstop = () => {
                            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                            const audioUrl = URL.createObjectURL(audioBlob);
                            const audio = document.getElementById('audioPlayback');
                            audio.src = audioUrl;
                            audio.style.display = 'block';
                        };

                        isRecording = true;
                        btn.innerText = "STOP";
                        timerDisplay.classList.add('recording');
                        startTimer();
                    })
                    .catch(err => alert("Microphone access denied. You can still use the timer/prompts."));
            } else {
                // STOP RECORDING
                mediaRecorder.stop();
                isRecording = false;
                btn.innerText = "REC";
                timerDisplay.classList.remove('recording');
                stopTimer();
            }
        }

        function startTimer() {
            clearInterval(timerInterval);
            seconds = 0;
            const limit = parseInt(document.getElementById('timeSelect').value);
            
            timerInterval = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
                const secs = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${mins}:${secs}`;

                if(seconds >= limit) {
                    document.getElementById('timer').style.color = "red";
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            document.getElementById('timer').style.color = "var(--slate-grey)";
        }

        function resetTimer() {
            stopTimer();
            seconds = 0;
            document.getElementById('timer').innerText = "00:00";
        }

        // --- AI PROMPT GENERATOR ---

        function generatePrompt() {
            if(!currentQ) return;

            const aiSection = document.getElementById('aiSection');
            const aiBox = document.getElementById('aiPromptBox');
            
            // Build the Prompt
            const prompt = `Act as a Senior Professional Review Interviewer (PRI) for the Engineering Council (UK). 

I am applying for CEng/IEng registration. I was asked this question regarding UK-SPEC Competency [${currentQ.catCode}]:
"${currentQ.text}"

Below is the transcript of my spoken answer:
"""
[PASTE YOUR TRANSCRIPT HERE]
"""

Please critique my response objectively against the UK-SPEC 4th Edition standards (https://www.engc.org.uk/professional-registration/our-professional-titles). 

1. Does this answer demonstrate the required level of responsibility and competence?
2. Identify 3 strengths in my delivery or technical content.
3. Identify 1 critical weakness or area where I was too vague (STAR method).
4. Suggest a follow-up "probing question" you would ask me next to test my depth.`;

            aiBox.value = prompt;
            aiSection.style.display = 'block';
            
            // Scroll to it
            aiSection.scrollIntoView({behavior: "smooth"});
        }

        function copyPrompt() {
            const copyText = document.getElementById("aiPromptBox");
            copyText.select();
            copyText.setSelectionRange(0, 99999); 
            navigator.clipboard.writeText(copyText.value);
            
            const btn = document.querySelector('.btn-ai');
            const originalText = btn.innerText;
            btn.innerText = "COPIED!";
            setTimeout(() => { btn.innerText = originalText; }, 2000);
        }

    </script>
</body>
</html>